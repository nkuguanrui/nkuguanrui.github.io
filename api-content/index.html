{"posts":[{"title":" [原创]python实现期权定价，期权交易策略（持续升级中....ing）","content":"本系列文章致力于用python实现与期权定价，期权交易策略，波动率交易策略等代码。 项目地址：python期权 期权定价 import BSmodel as bs s,k,r,t,v,cp = 10,10,0.03,30/365,1 &quot;&quot;&quot; s:标的价格 k:行权价格 r:无风险利率 t:剩余期限 v:波动率 cp:1为call ，-1为put &quot;&quot;&quot; p1 = bs.caculateBSM(s,k,r,t,v,cp) 隐含波动率 import BSmodel as bs s,k,r,t,v,cp = 10,10,0.03,30/365,1 price = 1 &quot;&quot;&quot; price:期权市场价格 s:标的价格 k:行权价格 r:无风险利率 t:剩余期限 cp:1为call ，-1为put &quot;&quot;&quot; IV1 = bs.caculateIV_Newton(price,s,k,r,t,cp)# 牛顿法 IV2 = bs.caculateIV_Dichotomy(price,s,k,r,t,cp) #二分法 ","link":"https://nkuguanrui.github.io/post/python-shi-xian-qi-quan-ding-jie-qi-quan-jiao-yi-ce-lue-chi-xu-sheng-ji-zhong-ing/"},{"title":"[论文复现]Tayal(2020)","content":"论文整体思路 马科维茨的均值-方差(MV)模型通过分散投资，计算给定目标收益率下的期望风险实现了金融资产的最优化配置。然而，由于维数诅咒和高交易成本，使得大量资产同时利用均值-方差(MV)模型进行最优化配置几乎不可能。 在模型中加入基数约束可以解决上述问题，但是带有基数约束的MV模型是NP完全问题，计算复杂度很大。一种解决办法是在求解模型前减小资产的数量，获得资产子集，从而解决基数约束问题。 聚类可以生成代表性子集，在进行MV最优化前主动减少资产的规模，从而加速模型求解速度。 均值方差模型 带有数量约束的MV最优化模型如图所示： 带有基数约束的MV最优化模型是在上述最优化模型基础上加入 ∑i=0nzi≤K(zi∈{0,1})\\sum_{i=0}^{n}{z_i} \\leq K (z_i \\in \\{0,1\\})∑i=0n​zi​≤K(zi​∈{0,1}) 其中K是资产组合中最大资产数量，ziz_izi​等于1表示投资组合中存在该资产，等于0表示不存在。 具有基数约束的MV模型可以使用基于元启发式的技术如模拟退火、遗传算法、禁忌搜索、人工蜂群算法、粒子群优化或其他启发式方法如神经网络来求解。 聚类MV模型 聚类可以生成代表性子集，从而构建最优化投资组合，聚类与MV模型集成模型可以由如下几个步骤实现。 确定最优簇数K。其目的是找到可以代表整个资产全集的子集，以便减少其维数 寻找代表性子集。其目的是以每个集群中指定一个具有代表性的资产 求解MV模型 滚动回测 计算样本外OOS收益率 ","link":"https://nkuguanrui.github.io/post/lun-wen-fu-xian-tayal2020/"},{"title":"[原创]马科维茨均值方差模型","content":"均值方差模型 马科维茨在《portfolio selection》（1952）提出均值方差模型，在给定期望收益下风险最小，或者给定风险下期望收益最大，其本质是数学中最优化问题。 实际操作中，利用N个资产的历史数据计算投资组合的收益和波动率，求解最优化问题做出有效前沿，其中夏普比率最大的组合是市场组合。 本文贡献 均值方差模型理论上会得到抛物线形状的散点图。但是在实际操作中，当资产数量N（5左右）不大时候，利用随机初始化权重方法可以画出较好的抛物线，但是当资产数量N太大时候（大于10）就很难通过随机初始化权重方法画出抛物线形状的散点图。 本项目利用A股历史数据，利用python实现均值方差模型画出有效前沿和CML（资本市场线），并且解决资产数量过大无法画出抛物线散点图的情况。 项目为马科维茨均值方差模型，地址：https://github.com/nkuguanrui/mean_variance_model python库 numpy matplotlib scipy itertools 数据来源 wind 代码和数据 详见主页 项目为马科维茨均值方差模型，地址：https://github.com/nkuguanrui/mean_variance_model 结果展示 ","link":"https://nkuguanrui.github.io/post/yuan-chuang-ma-ke-wei-ci-jun-zhi-fang-chai-mo-xing/"},{"title":" [研报复现]基于随机森林的多因子选股模型","content":"本项目参考了华泰证券研报《人工智能选股之随机森林模型》，项目绝大内容与研报类似，项目地址为：人工智能选股之随机森林模型，网址为：https://github.com/nkuguanrui/portfolio_select_with_random_forest。 随机森林 随机森林利用了Bagging思想，集合多个决策树的决策，最终达到“三个臭皮匠顶个诸葛亮”效果，如图1。有关随机森林具体做法可以参考研报和相关书籍。 因子选择 选择A股市场中表现较好的因子，如表1 表1：因子 大类因子 具体因子 因子描述 价值 pe_ttm 市盈率，股票的价格和每股收益的比率 价值 pb_ttm 市净率，每股股价与每股净资产的比率 价值 ps_ttm 市销率，总市值与主营业务收入的比率 价值 pcf_ttm 市现率，股票价格与每股现金流量的比率 价值 dividendyield 股息率，一年的总派息额与当时市价的比例 价值 g_pe 净利润（TTM）同比增长率/PE_TTM 成长 sales_g 营业收入（TTM）同比增长率 成长 sales_g_3y 营业收入三年复合增长率 成长 profit_g 净利润（TTM）同比增长率 成长 profit_g_3y 净利润三年复合增长率 成长 ocf_g 经营性现金流（TTM）同比增长率 成长 roe_g ROE（TTM）同比增长率 市值 ln_capital 总市值取对数 动量反转 return_Nm 个股最近N个月收益率，N=1,3,6,12 动量反转 wgt_return_Nm 个股最近N个月内用每日换手率乘以每日收益率求算术平均值N=1,3,6,12 动量反转 exp_wgt_return_Nm 个股最近N个月内用每日换手率乘以函数exp(-x_i/N/4)再乘以每日收益率求算术平均值，x_i为该日距离截面日的交易日的数,N=1,3,6,12 波动率 std_ff3factor_Nm 特质波动率——个股最近N个月内用日频收益率对FF三因子模型回归的残差的标准差，N=1,3,6,12 波动率 std_Nm 个股最近N个月的日收益率序列标准差，N=1,3,6,12 股价 ln_price 股价取对数 情绪 rating_average wind评级的平均值 情绪 rating_targetprice wind一致目标价/现价-1 股东 holder_avgpctchange 户均持股比例的同比增长率 技术 MACD 经典技术指标，长周期取30日，短周期取10日，计算DEA均线的周期（中周期）取15日 技术 DEA 经典技术指标，长周期取30日，短周期取10日，计算DEA均线的周期（中周期）取15日 技术 DIF 经典技术指标，长周期取30日，短周期取10日，计算DEA均线的周期（中周期）取15日 财务质量因子 roe_ttm 净资产收益率 财务质量因子 eps_ttm 每股收益 财务质量因子 ebit_ttm 税前利润率，税前利润比当期的销售收入 杠杆 currentratio 流动比率，流动负债/流动资产 杠杆 debtequityratio 非流动负债/净资产 换手率 bias_turn_Nm 个股最近N个月内日均换手率除以最近2年内日均换手率（剔除停牌、涨跌停的交易日）再减去1，N=1,3,6,12 模型构建 数据处理 数据获取 股票池：沪深300动态股票池月度数据。 回测区间：2010-01-01到2020-06-01 换仓期：在每个自然月最后一个交易日核算因子值，在下个自然月首个交易日按当日收盘价换仓。 数据来源：wind+聚宽 数据预处理 缺失值：拉格朗日插值法 极端值：MAD中位数去极值 标准化：最大最小标准化 特征与标签 特征：表1中50个因子 标签：在每个月末截面期，选取下月收益排名前 30%的股票作为正例（y = 1） ，后 30%的 股票作为负例（y = 0） 单测试集回测 训练集测试集划分 训练集区间：2010-01-01到2016-12-31 测试集区间：2017-01-01到2020-05-01 训练集参数寻优 KFold交叉验证 超参数：n_estimators;max_features;min_samples_leaf;min_samples_split 测试集回测 长时间跨度测试集回测 模型参数固定，可能会失效 回测指标 年化收益率 年化波动率 夏普比率 最大回撤 IR信息比率 超额收益 净值 滚动分层回测（多测试集回测） 行业中性策略 将随机森林预测值是为单因子，分别从各个行业中选出预测值排名靠前的N只股票等权配置。 等权重策略 将随机森林预测值是为单因子，直接从股票池中选取预测值排名靠前的N只股票等权配置。 实证研究 分别进行滚动行业中性策略，滚动等权重策略，行业中性单测试集策略，等权重单测试集策略。 滚动等权重策略 滚动窗口长度t：12，18，24 股票池N：10，20，50 回测区间：2017-2020 手续费：0.15% 滚动行业中性策略 滚动窗口长度t：12，18，24 单行业股票池N：2，5，10 回测区间：2017-2020 手续费：0.15% 等权重单测试集策略 股票池N：10，20，50 回测区间：2017-2020 手续费：0.15% 行业中性单测试集策略 单行业股票池N：2，5，10 回测区间：2017-2020 手续费：0.15% 实证结论 等权重策略随机森林选股策略可以获得稳定的超额收益，行业中性策略效果不明显，下面展示滚动等权重策略（t:12;N:10)，单测试集等权重策略（N:10)和HS300指数的净值走势，如图2。注：策略手续费0.15%，指数手续费0%。 代码和数据 项目地址为：人工智能选股之随机森林模型，网址为：https://github.com/nkuguanrui/portfolio_select_with_random_forest 未经授权不得转载或转载请注明出处 ","link":"https://nkuguanrui.github.io/post/ji-yu-sui-ji-sen-lin-de-duo-yin-zi-xuan-gu-mo-xing/"},{"title":" [原创]中国波指（000188）编制（python）","content":"中国波指编制；中国波动率指数；复现中国波指000188；python； 中国波指介绍 上证 50 ETF 波动率指数是基于上海证券交易所挂牌的 50 ETF 期权合约编制而成，反映投资者对未来 30 天 50 ETF 波动率的预期。上证 50 ETF 波动率指数不仅是反映投资者情绪的重要指标，也是衍生产品的重要标的，可作为投资者管控风险的有力工具。由于种种原因，中国波指在2018年停止发布本。项目目的是严格按照官方发布的指数编制方法重新复现波动率指数，数据和代码详见项目主页中国波指python编制，网址：https://github.com/nkuguanrui/ivx。 指数名称：上证 50 ETF 波动率指数 指数简称：中国波指 英文名称：SSE 50 ETF Volatility Index 英文简称：iVX 指数代码：000188 计算方法 上证 50 ETF 波动率指数是基于方差互换原理，采用上证 50 ETF 期权相关数据计算而得。具体计算方法参考中证指数有限公司分布的《上证50ETF波动率指数编制方案》。 指数复现 由于种种原因，中国波指在2018年官方停止发布，本项目利用python和期权数据，严格按照中国波指官方编制方案，对中国波指进行复制，目的是为了可以获得最新的中国波指数据，方面投资者进行风险管控。 数据来源 wind数据库，上证50ETF期权日度数据 方法 python+《上证50ETF波动率指数编制方案》 结论 复现的波动率指数和中国波指相似度高达98.3%，达到实践可用水平,如图。 数据和代码 数据和代码详见项目主页中国波指python编制,网址：https://github.com/nkuguanrui/ivx。 未经授权不得转载或转载请注明出处 ","link":"https://nkuguanrui.github.io/post/zhong-guo-bo-zhi-000188bian-zhi-python/"},{"title":"[文献复现]Fama-French(1992)","content":"项目目的 本项目利用美国股票月度历史数据，利用python严格按照FamaFrench(1992)中的方法构造三因子（市场因子，HML因子，SMB因子），并且按照论文中所用的方法对模型进行时间序列回归检验。在文章写作过程中，本文会把重要的细节的附上原文。详见项目FamaFrench3Factors，项目地址为：https://github.com/nkuguanrui/FamaFrenchThreeFacorModel 三因子构建 数据来源 wrds数据库 CRSP COMPUSTAT 数据处理 删除金融公司(We exclude financial firms because the high leverage that is normal for these firms probably does not have the same meaning as for nonfinancial firms, where high leverage more likely indicates distress.) 为了确保财报发布，将t-1年的财务信息与t年7月到t+1年6月的收益率进行匹配,也就是说，将上市公司年报发布时间统一设定在下一年的6月。(To ensure that the accounting variables are known before the returns they are used to explain, we match the accounting data for all fiscal yearends in calendar year t - 1 (1962-1989) with the returns for July of year t to June of t + 1.) 因子构建 t年的6月，以纽交所股票截面数据，计算市值的50%分位点和BM(book-to-markert ratio)的30%和70%分位点。 计算BM分位点史去掉BM小于0的股票(We do not use negative-BE firms, when calculating the breakpoints for BM or when forming the size-BM portfolios.) 市值(size)选择t年6月的数据;BM是用t-1年财年末的账面价值除以t-1年末的市值 对纽交所，纳斯达克，美交所股票做2x3独立双重排序(independent double sorting),分成6组，计算每组t年7月到t+1年6月的月度市值加权收益率。t+1年6月重新构造2x3组合。 构建HML和SMB因子: $SMB = (SH+SM+SL)/3 - (BH+BM+BL)/3 $ HML=(SH+BH)/2−(SL+BL)/2HML= (SH+BH)/2 - (SL+BL)/2HML=(SH+BH)/2−(SL+BL)/2 市场因子：RM-RF RM：全部股票月度市值加权收益率 RF：一个月国债收益率 因子检验 FamaFrench(1992)利用时间序列回归，估计定价误差，对三因子模型进行检验。 构造25个投资组合，构造方法和因子构建中的方法一致，唯一的差别是做5x5独立双重排序。 计算25个组合的月度加权收益率，计算超额收益 以25个组合的超额收益为因变量，以三因子为自变量，进行时间序列回归，股票定价误差和β\\betaβ 对定价误差进行α\\alphaα检验，如果定价误差不显著不等于0，则多因子模型有效 对β\\betaβ进行检验，发现β\\betaβ显著不等于0，说明因子对25个投资组合的超额收益率有显著的解释能力。 数据和代码 详见项目FamaFrench3Factors，项目地址为：https://github.com/nkuguanrui/FamaFrenchThreeFacorModel ","link":"https://nkuguanrui.github.io/post/xue-zhu-wen-xian-fu-xian-fama-french(1992)/"}]}